{
  "name": "better-auth",
  "type": "auth",
  "priority": 10,
  "operations": [
    {
      "type": "create-file",
      "source": "shared/lib/auth.ts",
      "destination": "server/auth/auth.ts",
      "condition": { "framework": ["nextjs"] }
    },
    {
      "type": "create-file",
      "source": "shared/lib/auth.ts",
      "destination": "src/modules/auth/auth.ts",
      "condition": { "framework": ["express"] }
    },
    {
      "type": "create-file",
      "source": "shared/lib/email/email-service.ts",
      "destination": "server/service/email/email-service.ts",
      "condition": { "framework": ["nextjs"] }
    },
    {
      "type": "create-file",
      "source": "shared/lib/email/email-service.ts",
      "destination": "src/shared/email/email-service.ts",
      "condition": { "framework": ["express"] }
    },
    {
      "type": "create-file",
      "source": "shared/lib/email/email-templates.ts",
      "destination": "server/service/email/email-templates.ts",
      "condition": { "framework": ["nextjs"] }
    },
    {
      "type": "create-file",
      "source": "shared/lib/email/email-templates.ts",
      "destination": "src/shared/email/email-templates.ts",
      "condition": { "framework": ["express"] }
    },
    {
      "type": "create-file",
      "source": "nextjs/api/auth/[...all]/route.ts",
      "destination": "app/api/auth/[...all]/route.ts",
      "condition": { "framework": "nextjs" }
    },
    {
      "type": "create-file",
      "source": "nextjs/proxy.ts",
      "destination": "proxy.ts",
      "condition": { "framework": "nextjs" }
    },
    {
      "type": "create-file",
      "source": "nextjs/lib/auth/auth-guards.ts",
      "destination": "server/auth/guards.ts",
      "condition": { "framework": "nextjs" }
    },
    {
      "type": "create-file",
      "source": "express/middlewares/authorize.ts",
      "destination": "src/shared/middlewares/authorize.ts",
      "condition": { "framework": "express" }
    },
    {
      "type": "create-file",
      "source": "express/types/express.d.ts",
      "destination": "src/types/express.d.ts",
      "condition": { "framework": "express" }
    },
    {
      "type": "create-file",
      "source": "shared/lib/auth-client.ts",
      "destination": "lib/auth/auth-client.ts",
      "condition": { "framework": ["nextjs"] }
    },
    {
      "type": "create-file",
      "source": "shared/lib/auth-client.ts",
      "destination": "src/shared/lib/auth-client.ts",
      "condition": { "framework": ["react"] }
    },
    {
      "type": "patch-file",
      "destination": "prisma/schema.prisma",
      "condition": { "database": "prisma" },
      "operations": [
        {
          "type": "add-to-bottom",
          "source": "shared/prisma/schema.prisma"
        }
      ]
    },
    {
      "type": "patch-file",
      "destination": "src/server.ts",
      "condition": { "framework": "express" },
      "operations": [
        {
          "type": "add-import",
          "imports": ["import { setupAuth } from \"./modules/auth/auth\";"]
        },
        {
          "type": "add-code",
          "before": "const port = env.port;",
          "code": "await setupAuth();"
        }
      ]
    },
    {
      "type": "patch-file",
      "destination": "src/app.ts",
      "condition": { "framework": "express" },
      "operations": [
        {
          "type": "add-import",
          "imports": ["import { auth } from \"./modules/auth/auth\";",
          "import { toNodeHandler } from \"better-auth/node\";"]
        },
        {
          "type": "add-code",
          "after": "// API routes",
          "code": "app.all(\"/api/auth/*splat\", (req: Request, res: Response) => {\\n  if (!auth) {\\n    return res.status(503).json({ success: false, message: \"Auth not ready\" });\\n  }\\n  return toNodeHandler(auth)(req, res);\\n});"
        }
      ]
    },
    {
      "type": "add-dependency",
      "condition": { "framework": ["nextjs", "express"] },
      "dependencies": {
        "nodemailer": "^7.0.12"
      },
      "devDependencies": {
        "@types/nodemailer": "^7.0.5"
      }
    },
    {
      "type": "add-env",
      "envVars": {
        "BETTER_AUTH_SECRET": "",
        "BETTER_AUTH_URL": "http://localhost:3000",
        "EMAIL_HOST": "smtp.gmail.com",
        "EMAIL_PORT": "587",
        "EMAIL_USER": "",
        "EMAIL_PASS": "",
        "EMAIL_FROM": "noreply@yourapp.com"
        }
      },
    {
      "type": "add-dependency",
      "dependencies": {
        "better-auth": "^1.4.12"
      }
    }
  ]
}