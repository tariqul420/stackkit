{
  "name": "better-auth",
  "type": "auth",
  "priority": 10,
  "operations": [
    {
      "type": "create-file",
      "source": "shared/lib/auth.ts",
      "destination": "src/lib/auth.ts",
      "condition": { "framework": ["express"] }
    },
    {
      "type": "create-file",
      "source": "express/types/express.d.ts",
      "destination": "src/types/express.d.ts",
      "condition": { "framework": "express" }
    },
    {
      "type": "create-file",
      "source": "express/config/env.ts",
      "destination": "src/config/env.ts",
      "condition": { "framework": "express" }
    },
    {
      "type": "create-file",
      "source": "express/modules/auth/*",
      "destination": "src/modules/auth/*",
      "condition": { "framework": "express" }
    },
    {
      "type": "create-file",
      "source": "express/middlewares/authorize.ts",
      "destination": "src/shared/middlewares/authorize.middleware.ts",
      "condition": { "framework": "express" }
    },
    {
      "type": "create-file",
      "source": "express/templates/*",
      "destination": "src/templates/*",
      "condition": { "framework": "express" }
    },
    {
      "type": "create-file",
      "source": "express/utils/*",
      "destination": "src/shared/utils/*",
      "condition": { "framework": "express" }
    },
    {
      "type": "patch-file",
      "destination": "src/app.ts",
      "condition": { "framework": "express" },
      "operations": [
        {
          "type": "add-import",
          "imports": [
            "import { auth } from \"./lib/auth\";",
            "import { toNodeHandler } from \"better-auth/node\";",
            "import path from \"path\";"
          ]
        },
        {
          "type": "add-code",
          "after": "// API routes",
          "code": ["app.use(\"/api/auth\", toNodeHandler(auth));"]
        },
        {
          "type": "add-code",
          "after": "app.set(\"query parser\", (str: string) => qs.parse(str));",
          "code": [
            "app.set(\"view engine\", \"ejs\");",
            "app.set(\"views\", path.resolve(process.cwd(), `src/templates`));"
          ]
        }
      ]
    },
    {
      "type": "patch-file",
      "destination": "src/routes/index.ts",
      "condition": { "framework": "express" },
      "operations": [
        {
          "type": "add-import",
          "imports": ["import { authRoutes } from \"../modules/auth/auth.route\";"]
        },
        {
          "type": "add-code",
          "after": "router.use(\"/health\", healthRoutes);",
          "code": ["router.use(\"/auth\", authRoutes);"]
        }
      ]
    },
    {
      "type": "patch-file",
      "destination": "src/server.ts",
      "condition": { "framework": "express", "database": "mongoose" },
      "operations": [
        {
          "type": "add-import",
          "imports": ["import { setupAuth } from \"./modules/auth/auth\";"]
        },
        {
          "type": "add-code",
          "before": "app.listen(envVars.PORT, () => {",
          "code": "await setupAuth();"
        }
      ]
    },
    {
      "type": "add-dependency",
      "condition": { "framework": "express" },
      "dependencies": {
        "ejs": "^4.0.1",
        "jsonwebtoken": "^9.0.3"
      },
      "devDependencies": {
        "@types/ejs": "^3.1.5",
        "@types/jsonwebtoken": "^9.0.10"
      }
    },
    {
      "type": "add-env",
      "condition": { "framework": "express" },
      "envVars": {
        "BETTER_AUTH_URL": "http://localhost:3000/api/auth",
        "BETTER_AUTH_SECRET": "your_better_auth_secret",
        "BETTER_AUTH_SESSION_TOKEN_EXPIRES_IN": "1d",
        "BETTER_AUTH_SESSION_TOKEN_UPDATE_AGE": "1d",
        "ACCESS_TOKEN_SECRET": "your_access_token_secret",
        "ACCESS_TOKEN_EXPIRES_IN": "1d",
        "REFRESH_TOKEN_SECRET": "your_refresh_token_secret",
        "REFRESH_TOKEN_EXPIRES_IN": "7d",
        "GOOGLE_CALLBACK_URL": "http://localhost:5000/api/auth/callback/google",
        "EMAIL_SENDER_SMTP_USER": "your_email@gmail.com",
        "EMAIL_SENDER_SMTP_PASS": "your_email_password",
        "EMAIL_SENDER_SMTP_HOST": "smtp.gmail.com",
        "EMAIL_SENDER_SMTP_PORT": "465",
        "EMAIL_SENDER_SMTP_FROM": "your_email@gmail.com",
        "SUPER_ADMIN_EMAIL": "your_email@gmail.com",
        "SUPER_ADMIN_PASSWORD": "your_super_admin_password"
      }
    },
    {
      "type": "create-file",
      "source": "shared/lib/auth.ts",
      "destination": "server/auth/auth.ts",
      "condition": { "framework": ["nextjs"] }
    },
    {
      "type": "create-file",
      "source": "nextjs/api/auth/[...all]/route.ts",
      "destination": "app/api/auth/[...all]/route.ts",
      "condition": { "framework": "nextjs" }
    },
    {
      "type": "create-file",
      "source": "nextjs/lib/auth/auth-guards.ts",
      "destination": "server/auth/guards.ts",
      "condition": { "framework": "nextjs" }
    },
    {
      "type": "create-file",
      "source": "nextjs/proxy.ts",
      "destination": "proxy.ts",
      "condition": { "framework": "nextjs" }
    },
    {
      "type": "create-file",
      "source": "shared/lib/auth-client.ts",
      "destination": "lib/auth/auth-client.ts",
      "condition": { "framework": ["nextjs"] }
    },
    {
      "type": "create-file",
      "source": "shared/lib/auth-client.ts",
      "destination": "src/shared/lib/auth-client.ts",
      "condition": { "framework": ["react"] }
    },
    {
      "type": "patch-file",
      "destination": "prisma/schema.prisma",
      "condition": { "database": "prisma" },
      "operations": [
        {
          "type": "add-to-bottom",
          "source": "shared/prisma/schema.prisma"
        }
      ]
    },
    {
      "type": "add-dependency",
      "dependencies": {
        "better-auth": "^1.4.12",
        "nodemailer": "^7.0.12"
      },
      "devDependencies": {
        "@types/nodemailer": "^7.0.5"
      }
    }
  ]
}